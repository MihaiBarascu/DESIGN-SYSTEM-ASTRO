---
/**
 * TestimonialCard - Card pentru testimoniale cu suport video
 * Folosit pe homepage și pagina de testimoniale
 *
 * @see https://astro-embed.netlify.app/components/youtube/
 */
import { YouTube } from '@astro-community/astro-embed-youtube';

interface Props {
  name: string;
  body?: string;
  rating?: number;
  youtubeId?: string;
  profession?: string;
  location?: string;
  avatar?: string;
}

const { name, body, rating = 5, youtubeId, profession, location } = Astro.props;
---

<div
  class="bg-white dark:bg-slate-800 rounded-2xl shadow-lg hover:shadow-[0_8px_40px_rgba(243,85,37,0.12)] hover:-translate-y-1 border border-transparent hover:border-primary/10 transition-all duration-300 overflow-hidden h-full flex flex-col group"
>
  {/* Video testimonial - folosește pachetul oficial Astro */}
  {
    youtubeId && (
      <div class="aspect-video">
        <YouTube id={youtubeId} title={`Testimonial ${name}`} playlabel={`Redă testimonial ${name}`} />
      </div>
    )
  }

  <div class="p-6 flex flex-col flex-grow">
    {/* Rating stars + video badge */}
    <div class="flex items-center gap-1 mb-4">
      {
        [1, 2, 3, 4, 5].map((star) => (
          <svg
            class={`w-5 h-5 ${star <= rating ? 'text-primary' : 'text-gray-300'}`}
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
          </svg>
        ))
      }
      {
        youtubeId && (
          <span class="ml-2 text-xs bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400 px-2 py-0.5 rounded-full flex items-center gap-1">
            <svg class="w-3 h-3" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z" />
            </svg>
            Video
          </span>
        )
      }
    </div>

    {/* Text content - expandable for long testimonials */}
    {
      body && body.trim() && (
        <div class="flex-grow">
          {body.length > 200 ? (
            <details class="mb-4 group">
              <summary class="cursor-pointer list-none">
                <span class="text-muted italic block group-open:hidden">"{body.slice(0, 180)}..."</span>
                <span class="text-primary text-sm font-medium mt-2 block group-open:hidden hover:underline">
                  ▼ Vezi tot mesajul
                </span>
                <blockquote class="text-muted italic hidden group-open:block">"{body}"</blockquote>
                <span class="text-primary text-sm font-medium mt-2 hidden group-open:block hover:underline">
                  ▲ Restrânge
                </span>
              </summary>
            </details>
          ) : (
            <blockquote class="text-muted mb-4 italic">"{body}"</blockquote>
          )}
        </div>
      )
    }

    {/* Author info */}
    <div class="border-t pt-4 dark:border-slate-700 mt-auto">
      <p class="font-semibold">{name}</p>
      {profession && <p class="text-sm text-muted">{profession}</p>}
      {
        location && (
          <p class="text-sm text-muted flex items-center gap-1">
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
              />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
              />
            </svg>
            {location}
          </p>
        )
      }
    </div>
  </div>
</div>
